!function(a){var b=a.Ariel,c=function(){this._init(),this._initEvent()};b.override(c.prototype,{_maskTemplate:'<div class="dialog-mask"></div>',_template:'<div class="dialog-wrapper">    <div class="dialog">        <span class="dialog-title">支持的银行卡</span>        <a href="javascript:void(0);" class="dialog-close"></a>        <div class="dialog-list-ct">           <div class="dialog-list-scroller">               <div class="dialog-bank-list-wrapper">                   <span class="dialog-card-type-name">储蓄卡</span>                   <ul class="dialog-bank-list savings-card-bank-list"></ul>               </div>               <div class="dialog-bank-list-wrapper">                   <span class="dialog-card-type-name">信用卡</span>                   <ul class="dialog-bank-list credit-card-bank-list"></ul>               </div>           </div>        </div>        <a href="javascript:void(0);" class="newCard-dialog-close">我知道了</a>    </div></div>',_listItemTemplate:'<li class="dialog-list-item"><img class="dialog-bank-icon" src="{$bankIcon}"></img><span class="dialog-bank-name">{$bankName}</span></li>',_mask:null,_wrapper:null,_viewport:null,_init:function(){var a=this;a._mask=$(a._maskTemplate),a._wrapper=$(a._template),a._viewport=$("#viewport"),a._listScroller=new IScroll(a._wrapper.find(".dialog-list-ct").get(0))},_initEvent:function(){var a=this;a._wrapper.find(".newCard-dialog-close").click(function(){a.hide()})},show:function(a){var b=this;b._renderData(),b._viewport.append(b._mask),b._viewport.append(b._wrapper),b._listScroller.refresh()},_renderData:function(){var a=this,b=Common.JSON.parse(Ariel.Storage.get(Common.DataKeys.CACHE_PAY_BANKS_DATA));b&&(a._wrapper.find(".savings-card-bank-list").html(a._buildList(b.savingsCardBanks)),a._wrapper.find(".credit-card-bank-list").html(a._buildList(b.creditCardBanks)))},_buildList:function(a){for(var b=this,c=[],d=0;d<a.length;d++){var e=b._listItemTemplate,f=a[d];e=e.replace("{$bankIcon}",f.bankIcon),e=e.replace("{$bankName}",f.name),c.push(e)}return c.join("")},hide:function(){var a=this;a._wrapper.remove(),a._mask.remove()}}),a.NewCardDialog=new c}(window),NewCardPage=Ariel.extend(Page,{_txtCardNo:null,init:function(){var a=this;NewCardPage.__super__.init.call(a),a._txtCardNo=new Ariel.Components.Textfile({selector:".JS-page-ct .card-no",pattern:/^\d{15,20}$/,_displayReset:function(){0==a._txtCardNo._wrapper.find(".textfile-input").val().length?($(".CIRCLE").css("margin-left","0"),$(".PERCENT").css("width","0"),$(".INPUT_CARD_NUMBER").removeClass("RED_COLOR"),a._txtCardNo._wrapper.find(".textfile-reset").addClass("textfile-reset-hide")):($(".CIRCLE").css("margin-left","25%"),$(".PERCENT").css("width","26%"),$(".INPUT_CARD_NUMBER").addClass("RED_COLOR"),a._txtCardNo._wrapper.find(".textfile-reset").removeClass("textfile-reset-hide"))}}),a._txtCardNo.refresh(),a._pageScroller.refresh()},initEvent:function(){var a=this;NewCardPage.__super__.initEvent.call(a),$(".JS-page-ct .view-banks").bind("tap",function(){Ariel.mpingEvent("JDCashierFastPayAddNewCard_ShowSupportBanks",location.href),Ariel.Components.Loading.show(),a._loadBanks(function(){NewCardDialog.show()})}),$(".JS-page-ct .next").bind("tap",function(){return a._txtCardNo.isValid()?(Ariel.Components.Loading.show(),void a._loadBanks(function(){Ariel.mpingEvent("JDCashierFastPay_Rebind",location.href);var a=Common.JSON.parse(Ariel.Courier.get(Common.DataKeys.ACROSS_PAGES_PAY_REQUEST_DATA));a&&(a.cardNo=$(".JS-page-ct .card-no .textfile-input").val(),Ariel.Courier.add(Common.DataKeys.ACROSS_PAGES_PAY_REQUEST_DATA,JSON.stringify(a))),Ariel.Courier.remove(Common.DataKeys.NEW_CARD_INFO_DATA),setTimeout(function(){window.location.href="new-card-info.html"},200)})):void Ariel.Components.Pop.show("请输入正确的银行卡号")}),a._sendMonitorData()},_loadBanks:function(a){var b=this;return b._isCacheBanks()?(Ariel.Components.Loading.hide(),void a.call(b)):void Common.Net.ajax({url:"bankList.action",type:"POST",data:{},success:function(c){if(Ariel.Components.Loading.hide(),c.success){var d=b._formatBankData(c);Ariel.Storage.add(Common.DataKeys.CACHE_PAY_BANKS_DATA,JSON.stringify(d)),a.call(b)}else Ariel.Components.Pop.show("数据获取失败，请重试")}})},_isCacheBanks:function(){return!1},_formatBankData:function(a){var b=this,a=Common.JSON.parse(a.bankListJson);if(a)return{creditCardBanks:b._buildBankData(a.quickCreditList),savingsCardBanks:b._buildBankData(a.quickDebitList)}},_buildBankData:function(a){for(var b=[],c=a.length-1;c>=0;c--){var d=a[c];b.push({isVaildCVV2:d.isVaildCVV2?d.isVaildCVV2:"true",agencyCode:d.agencyCode,name:d.channelName,acronym:d.channelCode,bankIcon:d.bankIcon?d.bankIcon:"/pay/img/pay/bank-icon-default.png"})}return b}});