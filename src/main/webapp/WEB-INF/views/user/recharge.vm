<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1, user-scalable=no">
	<title>充值</title>
	<link rel="stylesheet" type="text/css" href="$link.getContextPath()/css/recharge.css" />
	<script type="text/javascript" src="$link.getContextPath()/js/jquery-2.1.3.min.js"></script>

	<script>
		$(function() {
			share_link='http://$request.serverName?iv=$session.getAttribute("principal").userId';
			$(".btn").click(function() {
				if ($(this).find(".img1").is(":visible")) {
					$(this).find(".img1").hide();
					$(this).find(".img2").show();
				} else {
					$(this).find(".img1").show();
					$(this).find(".img2").hide();
				}
			});
			$(".menu-btn").css({"color" : "#666"});
			$(".menu-btn").eq($tabIdx).css({"color" : "#E81959"});
			$('#tabs').children().eq($tabIdx).css("display", "block");
			
			$('#container').css('height',$(document).height()+20);
			
			if($tabIdx==1){
				$(window).scroll(function(){
					var scrollTop = $(this).scrollTop();
			　　	 	var scrollHeight = $(document).height();
				　　	var windowHeight = $(this).height();
			　　	  	if(scrollTop + windowHeight == scrollHeight){
					  	scrollData.nextPage();
					}
				});
				var scrollData={
						currentPage:0,
						target:$('#tabs').children().eq($tabIdx),
						pageSize:15,
						append:function(str){
							this.target.append(str);
						},
						nextPage:function(){
							this.currentPage++;
							$.ajax({ 
								url: '$link.getContextPath()/user/recharge/query',
								data:{accountType:"#if($tabIdx==0)KYY#elseif($tabIdx==1)DJY#end",page:this.currentPage,pageSize:this.pageSize},
								type:"post",
								success: function(data){
									var htmlStr='';
									for(var i=0;i<data.length;i++){
										htmlStr+='<div class="sale-list"><a href="$link.getContextPath()/user/recharge/detail?id='+data[i].id+'">\
											<div class="sale-1">\
												<p style="font-size: 14px; color: #232323;">';
										htmlStr+='<span style="color: #E81959"> ￥'+data[i].sum/100+'</span>';
										htmlStr+='</p>\
											</div>\
											<div class="sale-2">\
												<p>'+data[i].insertTime.replace(/(\d{4}-\d{2}-\d{2} \d{2}:\d{2}):\d{2}/,"$1")+'</p>\
											</div>\
											<div class="sale-3">\
												<p style="right: 13px; color: #666;float:right;margin:5px 1em 5px 1em">'+data[i].remark+'</p>\
											</div>\
											</a></div>';
									}
									if(data.length==0){
										$('#tip').css('display','block');
										$('#tip2').css('display','none');
									}else{
										$('#tip').css('display','none');
										$('#tip2').css('display','block');
									}
									scrollData.append(htmlStr);
								}
							});
						}
				}
				scrollData.nextPage();
			}
			
			function validateMsg(msg){
				$(".common-msg").text(msg);
				$(".common-msg").fadeIn();
				setTimeout(function () {
					$(".common-msg").fadeOut();
				}, 1500);
			}
			
			/*表单验证对象*/
			var formValidate={
				externalOrderId:{
					target:$("#externalOrderId"),
					reg:/^\d+$/,
					required:true,
					msg:"交易单号格式错误"
				},
				sum:{
					target:$("#sum"),
					reg:/^\d+.?(\d{1,2})?$/,
					required:true,
					msg:"充值金额为非0最多两位小数",
					gtMin:0
				},
				externalOrderTime:{
					target:$("#externalOrderTime"),
					required:true,
					msg:"请填写交易日期"
				},
				phone:{
					target:$("#phone"),
					reg:/^1[3|4|5|7|8][0-9]{9}$/,
					required:true,
					msg:"手机号码为空或格式错误"
				},
				validate:function(o){
					var v=o.target.val();
					if(o.required){
						if(v==""){//验证非空
							validateMsg(o.msg);
							return false;
						}
						
					}
					if(v!=""){
						if(o.reg!=undefined){//验证格式
							if(!o.reg.test(v)){
								validateMsg(o.msg);
								return false;
							}
						}
						if(o.gtMin!=undefined){
							if(!parseFloat(v)>parseFloat(o.gtMin)){
								validateMsg(o.msg);
								return false;
							}
						}
					}
					return true;
				},
				validateAll:function(){
					if(this.validate(this.externalOrderId)&&this.validate(this.sum)&&this.validate(this.phone)){
						return true;
					}
					return false;
				}
			}
			
			var rechargeBtnAble=true;
			$('#rechargeBtn').click(function(){
				if(rechargeBtnAble){
					if(formValidate.validateAll()){
						rechargeBtnAble=false;
						$('#form1').submit();
					};
				}
			})
			

		});
	</script>
</head>
<body>
	#parse("./common/header.vm")
	<div id="container">
		<div class="header">
			<a href="$link.getContextPath()/user/wealth" class="header-back btn"> <img class="img1"
				src="$link.getContextPath()/images/back_n.png"> <img class="img2"
					src="$link.getContextPath()/images/back_p.png"></a> <span>充值</span>
		</div>
		<div class="header-menu">
			<ul>
				<li><a href="$link.getContextPath()/user/recharge?tabIdx=0" class="menu-btn">线下充值</a></li>
				<li><a href="$link.getContextPath()/user/recharge?tabIdx=1" class="menu-btn">充值记录</a></li>
			</ul>
		</div>
		<div id="tabs">
			<div class="sale-area1" style="display: none; padding-bottom: 10px;">
				<form id="form1" method="post" action="$link.getContextPath()/user/applyOfflineRecharge">
					<table style="width: 100%;">
						<tr>
							<td class="label">免费号</td>
							<td><input class="input" disabled=disabled type="text" value="$session.getAttribute("principal").luckNum"></input></td>
						</tr>
						<tr>
							<td class="label">交易单号</td>
							<td><input class="input" type="tel" id="externalOrderId" name='externalOrderId'></input></td>
						</tr>
						<tr>
							<td class="label">充值金额</td>
							<td><input class="input" type="tel" id="sum" name="sum"></input></td>
						</tr>
						<tr>
							<td class="label">手机号码</td>
							<td><input class="input" type="tel" id="phone" name="phone"></input></td>
						</tr>
						<!-- 						<tr> -->
						<!-- 							<td class="label">交易时间</td> -->
						<!-- 							<td><input class="input" type="datetime-local" id="externalOrderTime" name="externalOrderTime"></input></td> -->
						<!-- 						</tr> -->
						<tr>
							<td class="label">备注说明</td>
							<td>
								<input class="input" type="text" id="remark" name="remark">
							</td>
						</tr>
					</table>
			</div>
			<div class="sale-area1" style="display: none;"></div>
		</div>
		<div style="clear: both;"></div>
		<div #if($tabIdx!=0)style= "display:none;"#end>
			<div class="bankInfo">
				<table style="width: 100%;">
					<tr>
						<td colspan="2">
							<span style="display: block;font-size: 14px;color:#666;">第三方线下付款有以下两种方式：</span>
							<span style="display:block;font-size:16px;color:red;margin-top:8px;font-weight: bold;">注：以下两种方式都需要在备注栏准确填写本人的“免费号”！如：100052345</span>
						</td>
					</tr>
	 				<tr>
	 					<td>
	 						<span style="display:block;font-size:14px;margin-top:4px;color:#666;"><span style="vertical-align: middle;font-size:20px;">❶</span>支付宝账户</span>
	 						<span style="display:block;font-size:14px;margin-top:4px;color:#666;">昵称：广州我的免费网信息科技有限公司</span>
	 						<span style="display:block;font-size:14px;margin-top:4px;color:#666;">支付宝账号：3368440932＠qq.com</span>
	 					</td>
					</tr>
	 				<tr>
	 					<td>
	 						<span style="display:block;font-size:14px;margin-top:4px;color:#666;"><span style="vertical-align: middle;font-size:20px;">❷</span>收款银行账户（此账户只接受电脑端网银支付）</span>
	 						<span style="display:block;font-size:14px;margin-top:4px;color:#666;">开户银行：中国建设银行 广州市人和支行</span>
	 						<span style="display:block;font-size:14px;margin-top:4px;color:#666;">账号：6217003320040948237</span>
	 						<span style="display:block;font-size:14px;margin-top:4px;color:#666;">户名：张东伟</span>
	 					</td>
					</tr>
				</table>
			</div>
			<div class="footer-btn">
				<a href="javascript:void(0);" id="rechargeBtn" style="margin: 0 10%; width: 80%">充值</a>
			</div>
		</div>
		<div id='tip' style="display: none; padding-bottom: 5px;">
			<p style="text-align: center; color: #666; font-size: 14px;">没有更多了~</p>
		</div>
		<div id='tip2' style="display: none; padding-bottom: 5px;">
			<p style="text-align: center; color: #666; font-size: 14px;">继续拖动，查看更多</p>
		</div>
	</div>
	<div class="common-msg"></div>
</body>
</html>

