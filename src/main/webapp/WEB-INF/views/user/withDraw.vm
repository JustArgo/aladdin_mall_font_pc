#set($tmp=$remainingSum/100.0)
#set($remainingSum=$number.format("#0.00",$tmp))
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
<title>提现申请</title>
<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">
	<link rel="stylesheet" href="$link.getContextPath()/css/common.css" type="text/css" />
	<link rel="stylesheet" href="$link.getContextPath()/css/reflect-money.css" type="text/css" />
	<script src="$link.getContextPath()/js/jquery-2.1.3.min.js"></script>
	<script>
		$(function() {
			$(".btn").click(function() {
				if ($(this).find(".img1").is(":visible")) {
					$(this).find(".img1").hide();
					$(this).find(".img2").show();
				} else {
					$(this).find(".img1").show();
					$(this).find(".img2").hide();
				}
			});

			$("#reflect-btn").click(function() {
				$(this).css({
					"color" : "#fff",
					"background-color" : "#E81959"
				});
				setTimeout(function() {
					$("#reflect-btn").css({
						"color" : "#5e5b5c",
						"background-color" : "#fff"
					});
				}, 1000)
			});

			
			var moneyValidate = {
				element : $('#money'),
				max:$remainingSum,
				preValue : null,
				bind : function() {
					moneyValidate.element.keydown(function(e) {
						moneyValidate.preValue = moneyValidate.element.val();
					});
					moneyValidate.element.keyup(function(e) {
						var v = moneyValidate.element.val();
						var dotIdx = moneyValidate.preValue.indexOf('.');
						var keyCode = v.substring(v.length - 1, v.length);
						if ((keyCode<"0"||keyCode>"9") && keyCode != ".") {
							moneyValidate.element.val(v.substring(0,
									v.length - 1));
							return;
						}
						if (dotIdx != -1) {
							if (keyCode == ".") {
								moneyValidate.element.val(v.substring(0,
										v.length - 1));
								return;
							}
							if (moneyValidate.preValue.substring(dotIdx, v.length).length == 3) {
								moneyValidate.element.val(v.substring(0,
										v.length - 1));
								return;
							}
						}
						if(parseFloat(v)>moneyValidate.max){
							moneyValidate.element.val(v.substring(0,
									v.length - 1));
							return;
						}
					});
				}
			}
			moneyValidate.bind();

			var reflectBtnAble=true;
			$("#reflect-btn").click(function() {
				if($(".bank-select").val()==='new'){
					location.href="/bankCard/add/1?addType=withDraw";
					return;
				}
				var wdmoney = $('#money').val();
				if(isNaN(wdmoney)){
					alert("提现金额请填入不小于1元的数字");
					return;
				}
				var fwdmoney = parseFloat(wdmoney);
				if(reflectBtnAble&&fwdmoney>=1){
					
				}else{
					alert("提现金额不得小于1元");
					return;
				}
				
				if(fwdmoney > ${remainingSum}){
					alert("提现金额不得大于当前余额");
					return;
				}
				reflectBtnAble=false;
				$('#form').submit();
				
				
			})
		});
	</script>
</head>
<body>
#parse("./common/header.vm")
	<div id="container">
		<div class="header">
			<a href="$link.getContextPath()/user/wealth" class="header-back btn" style="background:none;"> <img class="img1"
				src="$link.getContextPath()/images/back_n.png"> <img class="img2"
					src="$link.getContextPath()/images/back_p.png"></a> <span>提现申请</span>
		</div>
		<div class="reflect-area">
			<div class="reflect-title">
				<p>可用提现金额</p>
				<p style="color: #E81959">￥$remainingSum</p>
			</div>
			<div class="reflect-tip">
				<p style="margin-bottom: 10px">《提现协议》</p>
				<p>1.提现每月不超过5次</p>
				<p>2.提现金额不超过1000元</p>
				<p>3.申请提现后会在多少个工作日内处理</p>
			</div>
		</div>
		<form method="post" id="form" action="$link.getContextPath()/user/applyWithDrawUsingBankcard">
			<div class="reflect-content">
				<p>银行卡</p>
				<select name="bankCardId" class="bank-select">
					#foreach($bankCard in $bankCardList)
					<option value="${bankCard.id}">${bankCard.bankName}($bankCard.cardNum.substring($math.sub($bankCard.cardNum.length(),4),$bankCard.cardNum.length()))</option>			
					#end
					<option value="new">添加银行卡</option>
				</select>
				<p>提现金额</p>
				<p>
					￥<input type="tel" id="money" name="money" />
				</p>
				<p class="centent1 hide">当前余额为￥$remainingSum</p>
				<p class="centent2 hide">提现金额不能超过当前余额</p>
			</div>
		</form>
		<div class="reflect-footer">
			<a href="javascript:void();" id="reflect-btn">提 现</a>
		</div>
	</div>
</body>
</html>

